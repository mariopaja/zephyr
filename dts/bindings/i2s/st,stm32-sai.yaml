# Copyright (c) 2024 ZAL Zentrum f√ºr Angewandte Luftfahrtforschung GmbH
# SPDX-License-Identifier: Apache-2.0

description: STM32 SAI controller

compatible: "st,stm32-sai"

include: [i2s-controller.yaml, pinctrl-device.yaml]

properties:
  reg:
    required: true

  dmas:
    required: true

  dma-names:
    required: true
    description: |
      DMA channel name: "tx" or "rx", depending of expected device behavior.

  pinctrl-0:
    required: true

  pinctrl-names:
    required: true

  mclk-enable:
    type: boolean
    description: |
      Master Clock Output function.
      An mck pin must be listed within pinctrl-0 when enabling this property.

  mclk-divider:
    type: string
    default: "no-div"
    description: |
      Master Clock Divider Configuration.

      When no-div property is present:
      - MCKDIV = SAI_CK_x / (FS * (FRL + 1))
      Otherwise:
      - MCKDIV = SAI_CK_x / (FS * (OSR + 1) * 256)

      When div-256 is present OSR is set to 0.
      When div-512 is present OSR is set to 1.
    enum:
      - "no-div"
      - "div-256"
      - "div-512"

  synchronous:
    type: boolean
    description: |
      Synchronous mode.
      When present, the SAI controller is configured to work in synchronous mode.

  st,sai-pdm:
    type: boolean
    description: |
      When present, the SAI controller supports PDM (Pulse Density Modulation).

  st,sai-mode:
    type: string
    default: "i2s"
    description: |
      This property is only applicable for SAI instances that support PDM.
      Selects the operating mode of the SAI block. 

      - i2s: Standard I2S (Inter-IC Sound) mode.
      - pdm: PDM (Pulse Density Modulation) mode, typically used for dmic input.

      If not specified, the mode defaults to i2s.
    enum:
      - "i2s"
      - "pdm"

  st,sai-pdm-mic-pairs:
    type: int
    default: 1
    description: |
      This property is only applicable for SAI instances that support PDM.
      Defines the number of PDM microphone pairs connected to the SAI block.
      Each pair consists of two microphones sharing the same data line.

      Valid values:
        - 1: Two microphones (one pair)
        - 2: Four microphones (two pairs)
        - 3: Six microphones (three pairs)

      If not specified, the default value is 1.
    enum:
      - 1
      - 2
      - 3

  st,sai-pdm-ck:
    type: int
    default: 1
    description: |
      This property is only applicable for SAI instances that support PDM.
      Selects the PDM clock output configuration (SAI_CKx) for the SAI block.
    enum:
      - 1
      - 2